# 系统初始化

## 启动流程

```mermaid
graph LR
    按下开关-->内核第一行代码
    内核第一行代码-->用户态应用代码
    用户态应用代码-->Shell代码
    Shell代码-->Shell等待输入
```

## 总线

### 物理地址空间与物理内存空间

- 物理地址空间通常指系统总线的地址空间
  - 对64位系统，这个空间大小为 $2^{64}$
- 系统总线连接内存，也连接其他设备，每个设备占一块空间
  - 通常内存确实占用了绝大部分空间

### 总线事务

- 总线上的设备可以向总线发起请求，称为**事务 Transaction**
  - 例如 `(1742, READ 102)` 该事务对总线上所有设备可见

## BootLoader

> “启动计算机，你需要运行代码；运行代码，你需要启动计算机”

- 以树莓派为例
  - 上电后固定从 `0x0` 地址运行 `firmware`，也称为 `bootloader`
  - `0x0` 不是物理内存的地址，而是连在总线上的某个存储介质的地址
  - 由这段代码处理 CPU、SDRAM
  - 然后加载内核、文件系统到内存
- 不同厂商的启动实现可能不同

### 入口函数

- CPU从预定义的物理内存地址读取第一行代码，由硬件厂商决定
  - 树莓派
    - 32位为 `0x8000`
    - 64位为 `0x80000`
  - x86
    - `0x7C00`
